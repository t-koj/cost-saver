# cost-saver

GPU使用率を監視し、アイドル状態が一定時間続いた場合に自動でシステムをシャットダウンするツールです。ComfyUIなどGPUを利用するアプリケーションのコスト削減に役立ちます。

## 主な機能

- GPU使用率の常時監視
- 設定可能なアイドル時間経過後の自動シャットダウン
- Slack通知によるステータス報告
- シャットダウン前の警告通知
- 定期的なハートビート通知

## 必要環境

- NVIDIA GPU
- Python 3.8以上
- Slack Bot Token

## セットアップ手順

1. 依存パッケージのインストール:
   ```bash
   pip install -r requirements.txt
   ```

2. 環境変数の設定:
   ```bash
   cp .env.example .env
   # .envファイルを編集し、Slackトークン等を設定
   ```

3. 主な環境変数例:
   - `SLACKBOT_TOKEN`: Slack Bot Token
   - `SLACKBOT_CHANNEL`: 通知送信先のSlackチャンネルID

## 実行方法

```bash
python src/main.py
```

## 設定項目
### 環境変数一覧

| 環境変数名            | 必須/任意 | 説明                                         | デフォルト値   |
|----------------------|-----------|----------------------------------------------|----------------|
| `SLACKBOT_TOKEN`     | 必須      | Slack Botのトークン                          | なし           |
| `SLACKBOT_CHANNEL`   | 必須      | 通知を送信するSlackチャンネルID              | なし           |
| `GPU_INDEX`          | 任意      | 監視対象とするGPUのインデックス              | 0              |
| `TIME_THRESHOLD`     | 任意      | アイドル状態と判定するまでの時間（秒）        | 600            |
| `HEARTBEAT_THRESHOLD`| 任意      | ハートビート通知の間隔（秒）                  | 1800           |
| `INTERVAL`           | 任意      | GPU使用率の監視間隔（秒）                     | 10             |

## 注意事項

- 本ツールはシステムの自動シャットダウンを行うため、重要なデータは事前に保存してください
- 実行にsudo権限が必要な場合があります
- GPU使用率が0%の状態が設定時間続くとシャットダウンが実行されます

